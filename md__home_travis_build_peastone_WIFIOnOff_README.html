<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WifiOnOff: WIFIOnOff</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WifiOnOff
   </div>
   <div id="projectbrief">A socket which an be controlled by MQTT and HTTP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">WIFIOnOff </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/peastone/WIFIOnOff"><img src="https://travis-ci.org/peastone/WIFIOnOff.svg?branch=master" alt="Build Status" class="inline"/></a> <a href="https://www.gnu.org/licenses/gpl-3.0"><object type="image/svg+xml" style="pointer-events: none;" data="https://img.shields.io/badge/License-GPL%20v3-blue.svg">License: GPL v3</object></a></p>
<h2>Motivation</h2>
<p>This repository was inspired by the article <a href="https://www.heise.de/ct/ausgabe/2018-2-Steckdose-mit-eingebautem-ESP8266-mit-eigener-Firmware-betreiben-3929796.html">"Bastelfreundlich"</a> by the German computer magazine "c't". The article there is pretty much introductory. If you speak German and you have difficulties to get started, you can have a look there.</p>
<h2>Caution: Dragons ahead</h2>
<p>The relay in the Sonoff S20 EU can only handle 10 A. Do NOT plug in devices with draw more current. The maximum amount of current is also noted on the backside of the Sonoff S20 EU. It may differ in other variants sold, so have a look.</p>
<p>Never program the Sonoff S20, if it is connected to the mains. In Germany, that's 230 volts and you don't want to get an electric shock, which might even kill you.</p>
<p>That put ahead, go forward and be cautious!</p>
<h2>Flash it</h2>
<ol type="1">
<li>Install Arduino IDE <a href="https://www.arduino.cc/en/Guide/HomePage">(instructions)</a>.</li>
<li>Install Arduino core for ESP8266 <a href="https://github.com/esp8266/Arduino#installing-with-boards-manager">(instructions)</a>.</li>
<li>Install the library <a href="https://www.arduino.cc/en/Guide/Libraries#toc2">(instructions)</a> for <a href="https://github.com/256dpi/arduino-mqtt/">MQTT from Joël Gähwiler</a>.</li>
<li>Get yourself a FTDI-232-USB-TTL converter and some jumper wires.</li>
<li>Connect the FTDI to the Sonoff S20 (Pins from top to button: GND, TX, RX, 3.3V; Top is located right underneath the socket. Pin connection may vary for other variants or over time. You flash at your own risk.).</li>
<li>Build the software and flash it.</li>
</ol>
<p>The whole procedure may also be done with <a href="https://platformio.org/">PlatformIO</a>. It should be easy to find out the analogous steps for yourself. A platformio.ini is provided but must be adapted.</p>
<p><img src="/img/sonoff_pinout.png" alt="Image of Sonoff S20 and Sonoff Basic without housing" class="inline"/> <a href="https://github.com/ct-Open-Source/info-graphics/blob/master/sonoff_pinbelegung.png">"Sonoff Pinout"</a> by <a href="https://github.com/ct-Open-Source">ct-Open-Source</a> licensed under CC Attribution Share Alike 4.0 International.</p>
<h2>Use it</h2>
<ol type="1">
<li>Close the Sonoff S20. BE cautious! The device MUST be absolutely closed. You are working at your own risk here. If the device is open, you risk getting an electric shock or worse. If in doubt, ask an expert!</li>
<li>Plug the Sonoff S20 into the mains.</li>
<li>The LED will light green. An access point with the name "WIFIOnOff" will be started. Connect your mobile device and follow the captive portal. There you can enter your WiFi credentials or use WPS.</li>
<li>Find the device with an mDNS mobile phone app.</li>
<li>Open the web interface by entering the mDNS name into your browser.</li>
<li>Configure MQTT, if wanted.</li>
<li>Enjoy the web interface, MQTT and the physical button. Toggle the relay.</li>
</ol>
<h2>Documentation</h2>
<p>Please read the manual(<a href="https://peastone.github.io/WIFIOnOff/">HTML</a>, <a href="https://peastone.github.io/WIFIOnOff/refman.pdf">PDF</a>). It is pretty detailed and should answer most of your questions. Only the latest version is provided. All versions can be generated with <a href="https://www.stack.nl/~dimitri/doxygen/">Doxygen</a>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
