<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>WifiOnOff: WIFIOnOff</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">WifiOnOff
   </div>
   <div id="projectbrief">A socket which an be controlled by MQTT and HTTP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">WIFIOnOff </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/peastone/WIFIOnOff">![Build Status](https://travis-ci.org/peastone/WIFIOnOff.svg?branch=master)</a> <a href="https://www.gnu.org/licenses/gpl-3.0">![License: GPL v3](https://img.shields.io/badge/License-GPL%20v3-blue.svg)</a></p>
<h2>Motivation</h2>
<p>This repository was inspired by the article <a href="https://www.heise.de/ct/ausgabe/2018-2-Steckdose-mit-eingebautem-ESP8266-mit-eigener-Firmware-betreiben-3929796.html">"Bastelfreundlich"</a> by the German computer magazine "c't". The article there is pretty much introductory. If you speak German and you have difficulties to get started, you can have a look there.</p>
<h2>Caution: Dragons ahead</h2>
<p>The relay in the Sonoff S20 EU can only handle 10 A. Do NOT plug in devices with draw more current. The maximum amount of current is also noted on the backside of the Sonoff S20 EU. It may differ in other variants sold, so have a look.</p>
<p>Never program the Sonoff S20, if it is connected to the mains. In Germany, that's 230 volts and you don't want to get an electric shock, which might even kill you.</p>
<p>That put ahead, go forward and be cautious!</p>
<h2>Flash it</h2>
<ol type="1">
<li>Install Arduino IDE <a href="https://www.arduino.cc/en/Guide/HomePage">(instructions)</a>.</li>
<li>Install Arduino core for ESP8266 <a href="https://github.com/esp8266/Arduino#installing-with-boards-manager">(instructions)</a>.</li>
<li>Install the library <a href="https://www.arduino.cc/en/Guide/Libraries#toc2">(instructions)</a> for <a href="https://github.com/256dpi/arduino-mqtt/">MQTT from Joël Gähwiler</a>.</li>
<li>Get yourself a FTDI-232-USB-TTL converter and some jumper wires.</li>
<li>Connect the FTDI to the Sonoff S20 (Pins from top to button: GND, TX, RX, 3.3V; Top is located right underneath the socket. Pin connection may vary for other variants or over time. You flash at your own risk.).</li>
<li>Build the software and flash it.</li>
</ol>
<p>The whole procedure may also be done with <a href="https://platformio.org/">PlatformIO</a>. It should be easy to find out the analogous steps for yourself.</p>
<h2>Use it</h2>
<ol type="1">
<li>Close the Sonoff S20. BE cautious! The device MUST be absolutely closed. You are working at your own risk here. If the device is open, you risk getting an electric shock or worse. If in doubt, ask an expert!</li>
<li>Plug the Sonoff S20 into the mains.</li>
<li>Press the button until it flashes the first time. Press the button of the router immediately after that. The WPS procedure starts.</li>
<li>Find the device with an mDNS mobile phone app.</li>
<li>Open the web interface by entering the mDNS name into your browser.</li>
<li>Configure MQTT, if wanted.</li>
<li>Enjoy the web interface, MQTT and the physical button. Toggle the relay.</li>
</ol>
<h2>Last advice</h2>
<p>Please read the <a href="https://peastone.github.io/WIFIOnOff/">manual</a>. It is pretty detailed and should answer most of your questions. Only the latest version is provided. All versions can be generated with <a href="https://www.stack.nl/~dimitri/doxygen/">Doxygen</a>.</p>
<h2>Also thanks to</h2>
<ul>
<li>Jeroen de Bruijn for his <a href="https://gist.github.com/vidavidorra/548ffbcdae99d752da02">gist</a> on how to auto-deploy Doxygen documentation on Github pages with Travis CI </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
